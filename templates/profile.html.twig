{% extends 'page.html.twig' %}

{% block title %}
    {% if ownProfile %}
        {{ 'title.yourProfile'|trans }}
    {% else %}
        {{ 'title.otherProfile'|trans({'%username%': viewedUser.username}) }}
    {% endif %}
{% endblock %}

{% if ownProfile %}
    {% set active='profile' %}
{% endif %}

{% block content %}
    <div class="profile-header">
        <div class="profile-picture-container">
            <div class="profile-picture">
                <img src="{{ asset('img/' ~ viewedUser.image) }}" width=100% height=100%>
            </div>
        </div>
        <div class="profile-info-container">
            <div class="profile-info">
                <div class="profile-username">
                    {{ viewedUser.username }}
                    {% if friendState == 'friends' %}
                        <i style="color: #07bd16" class="fa fa-users"></i>
                    {% endif %}
                </div>
                {% if viewedUser.role == 'ROLE_ADMIN' %}
                    <div class="profile-admin">
                        <i class="fa fa-shield"></i> {{ 'profile.admin'|trans }}
                    </div>
                {% endif %}
                <div class="profile-registered">
                    {{ 'profile.memberSince'|trans }}{{ registrationDate }}
                </div>
                <div class="profile-bio">
                    {{ viewedUser.bio }}
                </div>
                <br>
                <div class="profile-button-bar">
                    {% if ownProfile %}
                        <a href="{{ path('editProfile') }}" class="profile-button">
                            {{ 'profile.editProfile'|trans }}
                        </a>
                    {% else %}
                        {% if friendState == 'incomingRequest' %}
                            <a id="profileFriendButton"
                               onclick="acceptProfileFriendRequest('{{ viewedUser.username }}','{{ viewedUser.image }}')"
                               class="profile-button">
                                {{ 'profile.acceptFriendRequest'|trans }} <i class="fa fa-plus"></i>
                            </a>
                            <a id="profileFriendButton2"
                               onclick="declineProfileFriendRequest('{{ viewedUser.username }}','{{ viewedUser.image }}')"
                               class="profile-button">
                                {{ 'profile.declineFriendRequest'|trans }} <i class="fa fa-remove"></i>
                            </a>
                        {% elseif friendState == 'outgoingRequest' %}
                            <a id="profileFriendButton"
                               onclick="revokeProfileFriendRequest('{{ viewedUser.username }}','{{ viewedUser.image }}')"
                               class="profile-button">
                                {{ 'profile.revokeFriendRequest'|trans }} <i class="fa fa-remove"></i>
                            </a>
                        {% elseif friendState == 'none' %}
                            <a id="profileFriendButton"
                               onclick="sendProfileFriendRequest('{{ viewedUser.username }}','{{ viewedUser.image }}')"
                               class="profile-button">
                                {{ 'profile.addFriend'|trans }} <i class="fa fa-plus"></i>
                            </a>
                        {% endif %}
                        <a href="#" class="profile-button">
                            {{ 'profile.message'|trans }} <i class="fa fa-comment"></i>
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="profile-threads-container">
        <div class="profile-threads-title">
            {% if ownProfile %}
                {{ 'profile.yourThreads'|trans }}
            {% else %}
                {{ 'profile.usersThreads'|trans({'%username%': viewedUser.username}) }}
            {% endif %}
        </div>

        <div class="profile-no-threads">
            {% if ownProfile %}
                {{ 'profile.youHaveNoThreadsYet'|trans }}
            {% else %}
                {{ 'profile.hasNoThreadsYet'|trans({'%username%': viewedUser.username}) }}
            {% endif %}
        </div>
    </div>

    <script>
        function sendProfileFriendRequest(username, img) {
            const button = document.getElementById('profileFriendButton');
            button.innerHTML = "{{ 'profile.revokeFriendRequest'|trans }} <i class='fa fa-remove'><i>";
            button.onclick = function () {};
            sendFriendRequest(username, img);
            blockProfileButton();
            delay(1000).then(() => unblockRevokeRequestButton(username, img));
        }

        function acceptProfileFriendRequest(username, img) {
            document.getElementById('profileFriendButton').style.display = 'none';
            acceptFriendRequest(username, img);
        }

        function revokeProfileFriendRequest(username, img) {
            const button = document.getElementById('profileFriendButton');
            button.innerHTML = "{{ 'profile.addFriend'|trans }} <i class='fa fa-plus'><i>";
            button.onclick = function () {};
            revokeFriendRequest(username);
            blockProfileButton();
            delay(1000).then(() => unblockAddFriendButton(username, img));
        }

        function declineProfileFriendRequest(username, img) {
            document.getElementById('profileFriendButton2').style.display = 'none';
            declineFriendRequest(username);
            const button = document.getElementById('profileFriendButton');
            button.innerHTML = "{{ 'profile.addFriend'|trans }} <i class='fa fa-plus'><i>";
            button.onclick = function () {};
            blockProfileButton();
            delay(1000).then(() => unblockAddFriendButton(username, img));
        }

        function blockProfileButton() {
            const button = document.getElementById('profileFriendButton');
            button.className = 'profile-button-disabled';
            button.onclick = function() {};
        }

        function unblockAddFriendButton(username, img) {
            const button = document.getElementById('profileFriendButton');
            button.className = 'profile-button';
            button.onclick = function() {
                sendProfileFriendRequest(username,img);
            }
        }

        function unblockRevokeRequestButton(username, img) {
            const button = document.getElementById('profileFriendButton');
            button.className = 'profile-button';
            button.onclick = function() {
                revokeProfileFriendRequest(username,img);
            }
        }
    </script>
{% endblock %}